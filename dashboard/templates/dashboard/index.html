<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sprott Student Investment Fund | Performance</title>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://code.highcharts.com/stock/highstock.js"></script>
    <script src="http://code.highcharts.com/highcharts-3d.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/journal/bootstrap.min.css" rel="stylesheet">
    {% load staticfiles %}
    <link href="{% static 'dashboard/styles.css' %}" rel="stylesheet">

    <!-- Main Portfolio Chart -->
    <script type="text/javascript">
    $(function () {
        $('[data-toggle="tooltip"]').tooltip({'container': 'body'});
    });
    $(function () {

        $.getJSON('/portfoliojson', function (data) {
            // Create the chart
            $('#portfolio').highcharts('StockChart', {
                chart:{backgroundColor:null},
                rangeSelector : {selected : 5},
                title : {text : ''},
                tooltip: {pointFormat: '<span style="color:{point.color}">\u25CF</span> {series.name}: <b>${point.y}</b><br/>'},
                yAxis: {gridLineDashStyle: 'dot'},
                xAxis: {
                    gridLineDashStyle: 'dot',
                    gridLineWidth: 1
                },
                series : [{
                    name : 'Fund Value',
                    data : data,
                    tooltip: {
                        valueDecimals: 2
                    }
                }]
            });
        });

    });
    </script>

    <!-- Allocation Pie Chart -->
    <script type="text/javascript">
    $(function () {

        $.getJSON('/allocationjson', function (data) {
            // Create the chart
            $('#allocation').highcharts({
                chart:{backgroundColor:null,
                       type: 'pie',
                       options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                       }},
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        depth: 45,
                        dataLabels: {
                            distance: 7,
                            style: { width:'50px' }
                        }
                }},
                title : {text : ''},
                tooltip: {pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'},
                series : [{name: 'Allocation', data : data}]
            });
        });

    });
    </script>

    <!-- RiskReward Chart -->
    <script type="text/javascript">
    $(function () {
            var request = {
                chart:{backgroundColor:null, type: 'line'},
                rangeSelector : {selected : 5},
                title : {text : ''},
                legend: {enabled: false},
                plotOptions: {
                    scatter: {
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}'
                        },
                        tooltip: {
                            headerFormat: '<center>{point.key}</center><br/><table>',
                            pointFormat: '<tr><td>Volatility: </td><td style="text-align:right"><b>{point.x:.2f}%</b></td></tr><br/>'+
                                         '<tr><td>{series.name}: </td><td style="text-align:right"><b>{point.y}%</b></td></tr>',
                            footerFormat: '</table>',
                            valueDecimals: 2
                        }
                    }
                },
                tooltip: {
                    headerFormat:'<table>',
                    pointFormat: '<tr><td>Volatility: </td><td style="text-align:right"><b>{point.x:.2f}%</b></td></tr><br/>'+
                                 '<tr><td>{series.name}: </td><td style="text-align:right"><b>{point.y}%</b></td></tr>',
                    footerFormat: '</table>',
                    valueDecimals: 2
                },
                yAxis: {gridLineDashStyle: 'dot',
                        title: { text: 'Annualized Expected Return' }

                },
                xAxis: {
                    gridLineDashStyle: 'dot',
                    gridLineWidth: 1,
                    title: { text: 'Annualized Volatility' }
                },
                series : []
            };

        $.getJSON('/frontierjson', function (data) {
            request.series[0] = {name: 'Efficient Frontier', data: data};
            $.getJSON('/relativefrontjson', function(data){
                request.series[1] = {name: 'Return', data: data, type: 'scatter'};
                $('#riskreward').highcharts(request);
            });
        });
    });
    </script>


    <!-- Sparkline Charts -->
    <script type="text/javascript">
        $(function () {
            var spkrequest = {
                chart:{
                    margin:[0, 0, 0, 0],
                    backgroundColor:'transparent',
                    style: {overflow: 'visible'}
                },
                title:{text:''},
                exporting: {enabled: false},
                credits:{enabled:false},
                xAxis:{
                    labels:{enabled:false},
                    title: {text:null},
                    startOnTick: false,
                    endOnTick: false,
                    tickPositions: []
                },
                yAxis:{
                    maxPadding:0,
                    minPadding:0,
                    gridLineWidth: 0,
                    endOnTick: false,
                    startOnTick: false,
                    labels:{enabled:false},
                    title: {text: null},
                    tickPositions: []
                },
                legend:{enabled:false},
                tooltip:{
                    enabled:true,
                    formatter: function(){
                        return '<center>'+Highcharts.dateFormat('%A, %B %e, %Y', new Date(this.x))+'</center><br/>'+
                               'Price: $'+Math.round(this.y*100)/100;
                    },
                    positioner: function (w, h, point) {
                                    return { x: point.plotX - w / 2, y: point.plotY - h};
                                }
                },
                plotOptions:{
                    series:{
                        fillOpacity: 0.25,
                        lineWidth:1,
                        shadow:false,
                        states:{hover:{lineWidth:1}},
                        marker:{
                            radius:2,
                            states:{
                                hover:{
                                    radius:2
                                }
                            }
                        }
                    }
                },
                series: []
            };

            var assetlist = [{{ assetids|join:", "}}];
            $.each(assetlist, function(i,a){
                $.getJSON('/spkperformancejson?a='+a, function (data) {

                    // shitty area fix
                    var minimum = 1000000;
                    for(dp=0; dp < data.length; dp++){
                        if(data[dp].y < minimum)
                            minimum = data[dp].y;
                    }
                    spkrequest.yAxis.min = minimum-1;

                    spkrequest.series[0] = {type:'area', data: data};
                    $('#spk_'+a).highcharts(spkrequest);
                });
            });

    });
    </script>
</head>
<body>
    <div class="pattern"> </div>
    <nav class="navbar navbar-default">
        <div class="container">
            <div class="col-md-1 logo">
                <img src="{% static 'dashboard/logo.png' %}" />
            </div>
            <div class="col-md-4 col-md-offset-7 zeropad">
                <h5><a href="#">About</a></h5>
                <h5><a href="#">SSIF Home Page</a></h5>
            </div>
        </div>
    </nav>
    <div class="container">

        <div class="col-md-12 zeropad" style="margin-bottom: 25px;">
            <div class="panel panel-default">
                <div class="panel-heading deepblue"> Fund Overview</div>
                <div class="panel-body">
                    <div class="col-md-12" style="margin-bottom: 25px; text-align:justify;">
                        <span class="deepblue"><b>The Sprott Student Investment Fund’s</b></span> equity portfolio takes a fundamental approach to investing with a
                        value orientation; seeking to maximize the value of its assets over the very long term. The primary
                        focus is on building a portfolio of wealth creating firms, with unique competitive advantages, strong
                        financial positions, and proven management teams. We strive to make these investments only in firms that
                        trade at discounts to their intrinsic value.
                    </div>
                    <h5 class="col-md-12 zeropad deepblue" style="margin: 0 0 15px 0; text-align:center;">
                        <span class="glyphicon glyphicon-info-sign" data-toggle="tooltip" data-placement="top" title="All Figures are annualized from daily data.  The SSIF Benchmark is calculated as 65% S&P 500 (US Equity) and 35% S&P TSX (CAN Equity)"></span>
                        Performance Statistics
                    </h5>
                    <div class="col-md-2 overview">Mean Return<br/> {{ avgRet }}%</div>
                    <div class="col-md-2 overview">Volatility<br/> {{ vola }}%</div>
                    <div class="col-md-2 overview">Sharpe Ratio<br/> {{ sharpe }}</div>
                    <div class="col-md-2 overview">Information Ratio<br/> {{ ir }}</div>
                    <div class="col-md-2 overview">Alpha<br/> {{ alpha }}%</div>
                    <div class="col-md-2 overview last">Benchmark Beta<br/> {{ beta }}</div>
                </div>
            </div>
        </div>
        <div class="col-md-12 zeropad">
            <h3 class="deepblue"><span class="glyphicon glyphicon-stats" aria-hidden="true"></span> Fund Performance</h3>
            <span class="lightblue">From {{ portfolioStartDate }} to Present</span>
            <div class="well">
                <div id="portfolio" style="height: 350px;"></div>
            </div>
        </div>
        <div class="col-md-6 zero-left-pad">
            <h3 class="deepblue"><span class="glyphicon glyphicon-tasks" aria-hidden="true"></span> Sector Allocation</h3>
            <div class="well">
                <div id="allocation" style="height: 300px;"></div>
            </div>
        </div>
        <div class="col-md-6 zero-right-pad">
            <h3 class="deepblue"><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> Risk/Return Frontier</h3>
            <div class="well">
                <div id="riskreward" style="height: 300px;"></div>
            </div>
        </div>
        <div class="col-md-12 zeropad">
            <h3 class="deepblue"><span class="glyphicon glyphicon-piggy-bank" aria-hidden="true"></span> Current Holdings</h3>
            <div class="well">
                <table class="table table-striped table-hover ">
                      <thead>
                        <tr class="deepblue">
                            <th>Ticker</th>
                            <th>Company</th>
                            <th>Sector</th>
                            <th>Country</th>
                            <th>Manager</th>
                            <th>5D Prices</th>
                            <th><center>Return</center></th>
                            <th><center>Yield</center></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for h in holdings %}
                            <tr>
                                <td class="col-md-1">{{h.ticker}}</td>
                                <td class="col-md-3">{{h.company}}</td>
                                <td class="col-md-2">{{h.sector}}</td>
                                <td class="col-md-1">{{h.country}}</td>
                                <td class="col-md-2">{{h.manager}}</td>
                                <td class="col-md-1"><div id="spk_{{h.assetid}}" style="height:25px; width:110px;"></div></td>
                                <td class="col-md-1"><center>
                                    {% if h.totalreturn > 0 %}
                                        <span class="text-success">{{h.totalreturn}}%</span>
                                    {% elif h.totalreturn < 0 %}
                                        <span class="text-danger">{{h.totalreturn}}%</span>
                                    {% else %}
                                        {{h.totalreturn}}%
                                    {% endif %}
                                </center></td>
                                <td class="col-md-1"><center>{{h.yield}}%</center></td>
                            </tr>
                        {% endfor %}
                      </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>